#include "<df>/dragonfruit.h"
#include "<ll>/rtaisix/aisix.h"
#include "../../libservice/libservice.h"

procedure Main (* -- *)
	auto pid
	GetPID pid!

	auto ret
	"init" AddService ret!

	if (ret@ 0 ~=)
		ret@ pid@ "pid%d: couldn't register as init (code %i)\n" Abort
	end

	pid@ "init: I am PID %d and I am up and running!\n" Printf

	while (1)
		auto child
		0 Wait ret! child!

		ret@ child@ "init: %d finished (%i)\n" Printf
	end
end